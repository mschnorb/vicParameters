t %>% html_node("#rt-graph-tbl-data td") %>% html_text()
t %>% html_node("#rt-graph-tbl-data td")
t %>% html_node("#rt-graph-tbl-data td") %>% html_text()
t %>% html_node("td") %>% html_text()
html_node(t,"#rt-graph-tbl-data td")
html_node(t,"rt-graph-tbl-data td")
html_node(t,"#rt-graph-tbl-data")
html_node(t,"#rt-graph-tbl-data")t
t
install.packages("RCurl")
library("curl", lib.loc="C:/Apps/R-3.2.1/library")
curl_options()
browseURL("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=")
t <- html("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=")
t
rm(t)
t <- html("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=")
library("rvest", lib.loc="C:/Apps/R-3.2.1/library")
t <- html("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=")
t
library("RCurl", lib.loc="C:/Apps/R-3.2.1/library")
x <- postForm("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=",)
x <- postForm("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=", disclaimer_action="I Agree")
x
x <- htmll(postForm("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=", disclaimer_action="I Agree"))
x <- html(postForm("http://wateroffice.ec.gc.ca/report/report_e.html?mode=Table&type=realTime&stn=08HA003&dataType=Real-Time&startDate=2014-10-01&endDate=2015-09-15&prm1=47&y1Max=&y1Min=&prm2=-1&y2Max=&y2Min=", disclaimer_action="I Agree"))
x
rm(x)
rm(t)
list("plyr", "ggplot")
gbulwa <- plot_veg_hypsometry(bulwa_hru)
gbulwa
gbulwa_bycell <- plot_veg_hypsometry(bulwa_hru, by_cell = TRUE)
gbulwa_bycell
ii <- order(bulwa_hru$CLASS, bulwa_hru$ELEVATION)
ii
temp <- bulwa_hru[ii,]
View(temp)
ggplot(data=temp, aes(x=ELEVATIO, y=cumsum(AREA_FRAC))) + geom_line(aes(color=CLASS))
ggplot(data=temp, aes(x=ELEVATION, y=cumsum(AREA_FRAC))) + geom_line(aes(color=CLASS))
ggplot(data=temp, aes(x=ELEVATION, y=cumsum(AREA_FRAC))) + geom_line(aes(color=as.factor(CLASS)))
ggplot(data=temp, aes(x=ELEVATION, y=cumsum(AREA_FRAC))) + geom_line(aes(color=factor(CLASS)))
temp2 <- ddply(temp, .(CLASS), cumsum)
library("plyr", lib.loc="C:/Apps/R-3.2.1/library")
temp2 <- ddply(temp, .(CLASS), cumsum)
temp2 <- ddply(temp[-1], .(CLASS), cumsum)
View(temp2)
rm(temp2)
temp2 <- ddply(temp[-1], .(CLASS), cumsum)
View(temp2)
temp3 <- cbind(temp, temp2$AREA_FRAC)
View(temp3)
ggplot(data=temp3, aes(x=ELEVATION, y=cumsum(AREA_FRAC))) + geom_line(aes(color=factor(CLASS)))
ggplot(data=temp3, aes(x=ELEVATION, y=cumsum(temp2$AREA_FRAC))) + geom_line(aes(color=factor(CLASS)))
ggplot(data=temp3, aes(x=ELEVATION, y=temp2$AREA_FRAC)) + geom_line(aes(color=factor(CLASS)))
ggplot(data=temp3, aes(x=ELEVATION, y=temp2$AREA_FRAC)) + geom_line(aes(color=factor(CLASS)))
sum(temp3$AREA_FRAC)
names(temp3)
names(temp3)[9]
names(temp3)[9] <- CAREA_FRAC
names(temp3)[9] <- "CAREA_FRAC"
rm(temp, temp2)
View(temp3)
temp3$CAREA_FRAC_N <- temp3$CAREA_FRAC/sum(temp3$AREA_FRAC)
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS)))
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS))) + coord_flip()
veg_class <- sort(unique(bulwa\$CLASS))
vc <- sort(unique(bulwa_hru$CLASS))
vc
eg <- set_veg_legend(vc)
leg <- eg
rm(eg)
leg
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS))) + scale_color_manual(labels = leg$lbl, values=leg$clr) + coord_flip()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS)), size=1) + scale_color_manual(labels = leg$lbl, values=leg$clr) + coord_flip()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS)), size=1) + scale_color_manual(labels = leg$lbl, values=leg$clr) + coord_flip() + theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS)), size=1) + scale_color_manual("CLass", labels = leg$lbl, values=leg$clr) + coord_flip() + theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) + geom_line(aes(color=factor(CLASS)), size=1) + scale_color_manual("Class", labels = leg$lbl, values=leg$clr) + coord_flip() + theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=1) +
scale_color_manual("Class", labels = leg$lbl, values=leg$clr) +
labs(y="Elevation (m)", x="Cumulative Area Fraction", color="Landcover")
coord_flip() +
theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=1) +
scale_color_manual("Land Cover", labels = leg$lbl, values=leg$clr) +
labs(y="Elevation (m)", x="Cumulative Area Fraction")
coord_flip() +
theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=1) +
scale_color_manual("Land Cover", labels = leg$lbl, values=leg$clr) +
labs(y="Elevation (m)", x="Cumulative Area Fraction") +
coord_flip() +
theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=1) +
scale_color_manual("Land Cover", labels = leg$lbl, values=leg$clr) +
labs(x="Elevation (m)", y="Cumulative Area Fraction") +
coord_flip() +
theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=2) +
scale_color_manual("Land Cover", labels = leg$lbl, values=leg$clr) +
labs(x="Elevation (m)", y="Cumulative Area Fraction") +
coord_flip() +
theme_bw()
ggplot(data=temp3, aes(x=ELEVATION, y=CAREA_FRAC_N)) +
geom_line(aes(color=factor(CLASS)), size=1) +
scale_color_manual("Land Cover", labels = leg$lbl, values=leg$clr) +
labs(x="Elevation (m)", y="Cumulative Area Fraction", title="Cumulative Vegetation Hypsometry") +
coord_flip() +
theme_bw()
temp2 <- ddply(temp[-1], .(CLASS), cumsum)
temp2 <- ddply(bulwa_hru[ii,][-1], .(CLASS), cumsum)
View(temp2)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
plot_cum_veg_hypsometry(bulwa_hru)
sum(hru_df$AREA_FRAC)
View(temp_df)
View(hru_df)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bulwa_hru)
plot_cum_veg_hypsometry(bridgr_hru)
plot_cum_veg_hypsometry(bridge_hru)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/plot_cum_veg_hypsometry.r')
plot_cum_veg_hypsometry(bridge_hru)
plot_cum_veg_hypsometry(bulwa_hru)
ggsave("figures/bulwa_veg_hypsometry.png", width = 8, height=6, units="in", dpi=600)
plot_veg_hypsometry(bulwa_hru)
ggsave("figures/bulwa_veg_hypsometry.png", width = 8, height=6, units="in", dpi=600)
plot_cum_veg_hypsometry(bulwa_hru)
ggsave("figures/bulwa_cum_veg_hypsometry.png", width = 8, height=6, units="in", dpi=600)
min(bulwa_hru$ELEVATION)
max(bulwa_hru$ELEVATION)
sum((subset(bulwa_hru, CLASS==2)$AREA_FRAC)
)
sum((subset(bulwa_hru, CLASS==2)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==3)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==4)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==1)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==6)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==7)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==8)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==11)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==20)$AREA_FRAC))/50
sum((subset(bulwa_hru, CLASS==19)$AREA_FRAC))/50
View(bridge_hru)
View(bridge_hru)
View(peyto_hru)
library("plyr", lib.loc="C:/Apps/R-3.2.1/library")
ddply(peyto_hru, .(CLASS, CELL_ID), summarize, AREA=sum(AREA_FRAC))
View(bridge_hru)
plot_veg_hypsometry(bulwa_hru, by_cell = TRUE)
plot_veg_hypsometry(subset(bulwa_hru, CELL_ID==389273)
)
bulwa_hru_389273 <- subset(bulwa_hru, CELL_ID==389273)
View(bulwa_hru_389273)
ddply(bulwa_hru_389273, .(CLASS, CELL_ID), summarize, AREA=sum(AREA_FRAC))
ddply(bulwa_hru_389273, .(BAND_ID, CELL_ID), summarize, AREA=sum(SHAPE_AREA))
sum(ddply(bulwa_hru_389273, .(BAND_ID, CELL_ID), summarize, AREA=sum(SHAPE_AREA))$AREA)
ddply(bulwa_hru_389273, .(BAND_ID, CELL_ID), summarize, AREA=sum(SHAPE_AREA))$AREA
sum(bulwa_hru_389273$AREA_FRAC)
sum(ddply(bulwa_hru_389273, .(BAND_ID, CELL_ID), summarize, AREA=sum(AREA_FRAC))$AREA)
ddply(bulwa_hru_389273, .(BAND_ID, CELL_ID), summarize, AREA=sum(AREA_FRAC))
ddply(bulwa_hru_389273, .(class, CELL_ID), summarize, AREA=sum(AREA_FRAC))
ddply(bulwa_hru_389273, .(CLASS, CELL_ID), summarize, AREA=sum(AREA_FRAC))
ddply(bulwa_hru_389273, .(CLASS), summarize, AREA=sum(AREA_FRAC))
dclass <- ddply(bulwa_hru_389273, .(CLASS), summarize, AREA=sum(AREA_FRAC))
dband <- ddply(bulwa_hru_389273, .(BAND_ID), summarize, AREA=sum(AREA_FRAC))
dban
dband
dclass
expand.grid(dclass$CLASS, dband$BAND_ID)
rep(c(1,2,3), 5)
View(temp2)
rm(temp2, temp3)
temp <- expand.grid(dclass$CLASS, dband$BAND_ID)
View(temp)
temp$CAREA <- rep(dclass$CLASS,14)
View(temp)
temp$CAREA <- rep(dclass$AREA,14)
dband
temp2 <- apply(temp, 1, function(x,y){ii<-which(y[,2]==x[1]); y$BAREA[,ii]<-x[1]}, temp)
temp2 <- apply(temp, 1, function(x,y){ii<-which(y$Var2==x[1]); y$BAREA[ii]<-x[1]}, temp)
temp2 <- apply(temp, 1, function(x,y){ii<-which(y$Var2==x[1]); y$BAREA[ii]<-x[1]}, dband)
temp2 <- apply(dband, 1, function(x,y){ii<-which(y$Var2==x[1]); y$BAREA[ii]<-x[1]}, temp)
rep(dband$AREA, 7)
lapply(dband$AREA, rep, 7)
do.call(rbind,lapply(dband$AREA, rep, 7))
do.call(rbind,t(lapply(dband$AREA, rep, 7)))
as.vector(do.call(rbind,lapply(dband$AREA, rep, 7)))
temp2 <- as.vector(do.call(rbind,lapply(dband$AREA, rep, 7)))
temp$BAREA <- temp2
View(temp)
temp2 <- as.vector(t(do.call(rbind,lapply(dband$AREA, rep, 7))))
temp$BAREA <- temp2
temp$AREA <- temp$CAREA * temp$BAREA
sum(temp$AREA)
temp_hru <- data.frame(POLY_ID=1:98, CLASS=NULL, CELL__D=389273, BAND_ID=NULL, SHAPE_AREA=NULL, ZONE_AREA=NULL, ELEVATION=NULL, AREA_FRAC=NULL)
temp_hru <- data.frame(POLY_ID=1:98, CLASS=NULL, CELL_ID=389273, BAND_ID=NULL, SHAPE_AREA=NULL, ZONE_AREA=NULL, ELEVATION=NULL, AREA_FRAC=NULL)
temp_hru <- data.frame(POLY_ID=1:98, CLASS=NULL, CELL_ID=NULL, BAND_ID=NULL, SHAPE_AREA=NULL, ZONE_AREA=NULL, ELEVATION=NULL, AREA_FRAC=NULL)
temp_hru <- data.frame(POLY_ID=1:98)
View(temp_hru)
View(temp)
temp_hru$CLASS <- temp$Var1
temp_hru$CELL_ID <- 389273
temp_hru$BAND_ID <- temp$Var2
temp_hru$SHAPE_AREA <- NULL
View(temp_hru)
temp_hru$SHAPE_AREA <- 99
View(temp_hru)
temp_hru$ZONE_AREA <- 99
View(temp_hru)
temp_hru$ELEVATION <- 99
View(temp_hru)
temp_hru$AREA_FRAACTION <- temp$AREA
View(temp_hru)
temp_hru$POLY_ID <- paste(temp_hru$CELL_ID, "_", temp_hru$BAND_ID, sep="")
View(temp_hru)
temp_hru$ZONE_AREA <- temp$BAREA
delev <- ddply(bulwa_hru_389273, .(BAND_ID), summarize, ELEV=mean(ELEVATION))
delev
temp2 <- as.vector(t(do.call(rbind,lapply(delev$ELEV, rep, 7))))
temp2
temp_hru$ELEVATION <- temp2
rm(temp, temp2)
rm(ii)
rm(vc)
rm(leg)
plot_veg_hypsometry(temp_hru)
names(temp_hru)[8] <- "AREA_FRAC"
View(temp_hru)
plot_veg_hypsometry(temp_hru)
cumsum(temp_hru$AREA_FRAC)
plot(cumsum(temp_hru$AREA_FRAC))
plot(temp_hru$ELEVATION, cumsum(temp_hru$AREA_FRAC))
df1 <- subset(temp_hru, BAND_ID<=1750)
View(df1)
sum(df1$AREA_FRAC)
df1 <- subset(temp_hru, BAND_ID<=1850)
sum(df1$AREA_FRAC)
df2 <- subset(temp_hru, BAND_ID>1850 & BAND_ID <=1950)
sum(df2$AREA_FRAC)
df3 <- subset(temp_hru, BAND_ID>1950 & BAND_ID <=2050)
sum(df3$AREA_FRAC)
df4 <- subset(temp_hru, BAND_ID>2050 & BAND_ID <=2250)
sum(df4$AREA_FRAC)
df5 <- subset(temp_hru, BAND_ID>2250 & BAND_ID <=2850)
sum(df5$AREA_FRAC)
df3 <- subset(temp_hru, BAND_ID>1950 & BAND_ID <=2150)
df4 <- subset(temp_hru, BAND_ID>2150 & BAND_ID <=2250)
sum(df3$AREA_FRAC)
sum(df4$AREA_FRAC)
df3 <- subset(temp_hru, BAND_ID>1950 & BAND_ID <=2050)
df4 <- subset(temp_hru, BAND_ID>2050 & BAND_ID <=2250)
df <- list(df1, df2, df3, df4, df5)
str(df)
ddply(df1, .(POLY_ID, CLASS, BAND_ID), ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
ddply(df1, .(CLASS, BAND_ID), ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
ddply(df1, .(CLASS, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
)
ddply(df1, .(CLASS), ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
ddply(df1, .(CLASS), ELEVATION=median(ELEVATION))
ddply(df1, .(CLASS), summrize, ELEVATION=median(ELEVATION))
ddply(df1, .(CLASS), summarize, ELEVATION=median(ELEVATION))
ddply(df1, .(CLASS), summarize, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
lapply(df, ddply, .(CLASS), summarize, ELEVATIO=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))
do.call(rbind,lapply(df, ddply, .(CLASS), summarize, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC)))
temp2_hru < as.data.frame(do.call(rbind,lapply(df, ddply, .(CLASS), summarize, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))))
temp2_hru <_ as.data.frame(do.call(rbind,lapply(df, ddply, .(CLASS), summarize, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))))
temp2_hru <- as.data.frame(do.call(rbind,lapply(df, ddply, .(CLASS), summarize, ELEVATION=median(ELEVATION), AREA_FRAC=sum(AREA_FRAC))))
View(temp2_hru)
temp2_hru$BAND_ID <- temp2_hru$ELEVATION
View(temp2_hru)
plot_veg_hypsometry(temp2_hru)
temp2_hru$CELL_ID <- 389273
View(temp2_hru)
plot_veg_hypsometry(temp2_hru)
plot(temp_hru$ELEVATION, cumsum(temp_hru$AREA_FRAC))
plot(cumsum(temp_hru$AREA_FRAC))
temp_hru$CUM_AREA_FRAC <- cumsum(temp_hru$AREA_FRAC)
View(temp_hru)
View(df1)
rm(df1, df2, df3, df4, df5, df)
df1 <- subset(temp_hru, CUM_AREA_FRAC < 0.2)
View(df1)
df2 <- subset(temp_hru, CUM_AREA_FRAC >= 0.2 & CUM_AREA_FRAC < 0.4)
df3 <- subset(temp_hru, CUM_AREA_FRAC >= 0.4 & CUM_AREA_FRAC < 0.6)
df4 <- subset(temp_hru, CUM_AREA_FRAC >= 0.6 & CUM_AREA_FRAC < 0.8)
df5 <- subset(temp_hru, CUM_AREA_FRAC >= 0.8 & CUM_AREA_FRAC < 1.01)
df <- list(df1, df2, df3, df4, df5)
View(df5)
sum(df5$AREA_FRAC)
sum(df4$AREA_FRAC)
sum(d3$AREA_FRAC)
sum(df3$AREA_FRAC)
sum(df2$AREA_FRAC)
sum(df1$AREA_FRAC)
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC))
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=(ELEVATION*AREA_FRAC/sum(AREA_FRAC)))
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=(ELEVATION*AREA_FRAC)))
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=ELEVATION*AREA_FRAC))
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=ELEVATION*AREA_FRAC)
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=1)
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=ELEVATION)
ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC), ELEVATION=sum(ELEVATION))
sum(df1$ELEVATION*df1*AREA_FRAC)/sum(df1$AREA_FRAC)
sum(df1$ELEVATION*df1$AREA_FRAC)/sum(df1$AREA_FRAC)
d <- ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC)); d$ELEVATION <- sum(df1$ELEVATION*df1$AREA_FRAC)/sum(df1$AREA_FRAC)
View(d)
d <- ddply(df1, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC)); d$ELEVATION <- sum(df1$ELEVATION*df1$AREA_FRAC)/sum(df1$AREA_FRAC); d$BAND_ID <- d$ELEVATION
View(d)
lapply(df, function(x){d <- ddply(x, .(CLASS), summarize, AREA_FRAC=mean(AREA_FRAC)); d$ELEVATION <- sum(x$ELEVATION*x$AREA_FRAC)/sum(x$AREA_FRAC); d$BAND_ID <- d$ELEVATION})
lapply(df, function(x){d <- ddply(x, .(CLASS), summarize, AREA_FRAC=sum(AREA_FRAC)); d$ELEVATION <- sum(x$ELEVATION*x$AREA_FRAC)/sum(x$AREA_FRAC); d$BAND_ID <- d$ELEVATION})
lapply(df, function(x){d <- ddply(x, .(CLASS), summarize, AREA_FRAC=sum(AREA_FRAC))})
lapply(df, function(x){d <- ddply(x, .(CLASS), summarize, AREA_FRAC=sum(AREA_FRAC)); d$ELEVATION <- x$ELEVATION*x$AREA_FRAC})
lapply(df, function(x){d <- ddply(x, .(CLASS), summarize, AREA_FRAC=sum(AREA_FRAC)); d$ELEVATION <- sum(x$ELEVATION*x$AREA_FRAC)})
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/summarize.df.r')
lapply(df, .(CLASS), summarize, summarize.df)
lapply(df, summarize.df)
df <- list(df1, df2, df3, df4, df5)
rm(df1, df2, df3, df4, df5)
View(temp2_hru)
rm(temp2_hru)
temp2_hru <- do.call(rbind,lapply(df, summarize.df))
View(temp2_hru)
temp2_hru$CELL_ID <- 389273
plot_veg_hypsometry(temp2_hru)
rm(d)
rm(dclass, delev, dband)
bulwa_hru_old1 <- temp_hru
bulwa_hru_old2 <- temp2_hru
rm(temp_hru, temp2_hru)
dclass <- ddply(bulwa_hru_old2, .(CLASS), summarize, AREA=sum(AREA_FRAC))
dclass
delev <- ddply(bulwa_hru_old2, .(BAND_ID), summarize, AREA=sum(AREA_FRAC))
delev
CAREA <- rep(dclass$AREA, 5)
CAREA
BAREA <- rep(delev$AREA,7)
BAREA
BAREA <- rep(delev$AREA,each=7)
BAREA
AREA <- BAREA*CAREA
AREA
temp2_hru$AREA_FRAC <- AREA
bulwa_hru_old2$AREA_FRAC <- AREA
View(bulwa_hru_old2)
plot_veg_hypsometry(bulwa_hru_old2)
rm(AREA, BAREA, CAREA)
rm(dlcass, delev)
rm(all_hru)
rm(dclass)
ggsave("figures/bulwa_hru_oldstyle.png", width=8, height=6, units="in", dpi=600)
plot_veg_hypsometry(bulwa_hru_389273)
ggsave("figures/bulwa_hru_newstyle.png", width=8, height=6, units="in", dpi=600)
View(bulwa_hru_old2)
View(bulwa_hru_389273)
View(bulwa_hru_old1)
bulwa_hru_389273$CUM_AREA_FRAC <- cumsum(bulwa_hru_389273$AREA_FRAC)
View(bulwa_hru_389273)
df1 <- subset(bulwa_hru_389273, CUM_AREA_FRAC < 0.2)
df2 <- subset(bulwa_hru_389273, CUM_AREA_FRAC >= 0.2 & CUM_AREA_FRAC < 0.4)
df3 <- subset(bulwa_hru_389273, CUM_AREA_FRAC >= 0.4 & CUM_AREA_FRAC < 0.6)
df4 <- subset(bulwa_hru_389273, CUM_AREA_FRAC >= 0.6 & CUM_AREA_FRAC < 0.8)
df5 <- subset(bulwa_hru_389273, CUM_AREA_FRAC >= 0.8 & CUM_AREA_FRAC < 1.01)
df <- list(df1, df2, df3, df4,df5)
temp2_hru <- do.call(rbind,lapply(df, summarize.df))
dclass <- ddply(bulwa_hru_389273, .(CLASS), summarize, AREA=sum(AREA_FRAC))
delev <- ddply(bulwa_hru_389273, .(BAND_ID), summarize, AREA=sum(AREA_FRAC))
CAREA <- rep(dclass$AREA, 5)
BAREA <- rep(delev$AREA,each=7)
AREA <- BAREA*CAREA
dclass
delev
delev <- ddply(temp2_hru, .(BAND_ID), summarize, AREA=sum(AREA_FRAC))
dclass <- ddply(temp2_hru, .(CLASS), summarize, AREA=sum(AREA_FRAC))
delev
dclass
CAREA <- rep(dclass$AREA, 5)
BAREA <- rep(delev$AREA,each=7)
AREA <- BAREA*CAREA
View(temp2_hru)
View(bulwa_hru_old2)
bulwa_hru_old2 <- temp2_hru
rm(temp2_hru)
View(bulwa_hru_old2)
bulwa_hru_old2$AREA_FRAC <- AREA
df <- list(df1, df2, df3, df4, df5)
temp2_hru <- do.call(rbind,lapply(df, summarize.df))
View(temp2_hru)
View(bulwa_hru_389273)
View(bulwa_hru_old2)
View(bulwa_hru_old2)
expand.grid(dclass$CLASS, delev$BAND_ID)
temp2 <- expand.grid(dclass$CLASS, delev$BAND_ID)
View(temp2)
names(temp2) <- c("CLASS", "ELEVATION")
temp2$BAND_ID <- temps$ELEVATION
View(temp2)
temp2$BAND_ID <- temp2$ELEVATION
temp2$CELL_ID <- 389273
temp2$AREA_FRAC <- AREA
plot_veg_hypsometry(temp2)
bulwa_hru_old2 <- temp2
plot_veg_hypsometry(bulwa_hru_old2)
ggsave("figures/bulwa_hru_oldstyle.png", width=8, height=6, units="in", dpi=600)
rm(df1, df2, df3, df4, df5, df)
rm(temp2, temp2_hru)
rm(delev, dclass)
View(bulwa_hru)
install.packages(c("coda", "fields", "lme4", "maps", "mgcv", "ncdf4", "Rcpp", "rgeos", "sp", "spam", "stringi"))
hru_BULWA <- read.csv("Y:/Work/PCIC/VIC/DATA/HRU_412/scratch/hru_BULWA.txt", stringsAsFactors=FALSE)
View(hru_BULWA)
names(hru_BULWA) <- c("LON", "LAT", "CELL_ID", "BAND_ID", "HRU_ID", "CLASS", "AREA", "ELEVATION")
View(hru_BULWA)
temp <- arrane(hru_BULWA, CELL_ID, BAND_ID, class)
temp <- arrange(hru_BULWA, CELL_ID, BAND_ID, class)
temp <- arrange(hru_BULWA, CELL_ID, BAND_ID, CLASS)
View(temp)
cell <- unique(temp$CELL_ID)
cell <- unique(temp$CELL_ID)
cell
length(cell)
rm(cell)
rm(temp)
temp <- ddply(hru_BULWA, .(CELL_ID), summarise, AREA=sum(AREA))
View(temp)
tt <- vapply(hru_BULWA$CELL_ID, function(x){ii <- which(temp$CELL_ID == x); return(temp$AREA[ii])})
warnings()
tt <- vapply(hru_BULWA$CELL_ID, function(x){ii <- which(temp$CELL_ID == x); return(temp$AREA[ii])})
tt <- sapply(hru_BULWA$CELL_ID, function(x){ii <- which(temp$CELL_ID == x); return(temp$AREA[ii])})
tt
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
area_frac <- hru_BULWA$AREA/tt
area_frac
area_frac
0.103488/31.04781
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
View(bulwa_hru)
0.021432/0.0625/0.0625
0.0625^2
View(temp)
temp$ARE_FRAC <- hru_BULWA$AREA/temp$AREA
temp$ARE_FRAC <- hru_BULWA$AREA/temp$AREA
rm(temp)
tt_df <- cbind(hru_BULWA, hru_BULWA$AREA/tt)
View(tt_df)
names(tt_df)
names(tt_df)[9] <- "AREA_FRAC"
View(tt_df)
ttt <- ddply(tt.df, .(CELL_ID), summarise, AREA=sum(AREA_FRAC))
ttt <- ddply(tt_df, .(CELL_ID), summarise, AREA=sum(AREA_FRAC))
View(ttt)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tm(tt, tt_df, ttt)
rm(tt, tt_df, ttt)
View(summarize.df)
View(root_depths)
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
View(cell_area_df)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
debugSource('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
install.packages("Rcpp")
install.packages("stringi")
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
tt <- make_VIC_param(hru_BULWA, root_depths, write_vpf = TRUE, write_snb = TRUE)
str(tt)
summary(tt)
str(tt, max.level = 2)
str(tt, max.level = 1)
tt$VPARAM[1]
sum(tt$VPARAM[1]$AFRAC)
tt$VPARAM[[1]]
tt$VPARAM[[1]]$AFRAC
tt$VPARAM[[1]][1]
tt$VPARAM[1][1]
tt$VPARAM[1]
str(tt$VPARAM[1])
str(tt$VPARAM[[1]])
str(tt$VPARAM[[1]][,2])
sum(tt$VPARAM[[1]][,2])
source('Z:/data/projects/hydrology/vic_gen2/input/vegetation/hru/code/R.git/make_VIC_param.r')
